# Axiom Go Adapter for rs/zerolog

Adapter to ship logs generated by [rs/zerolog](https://github.com/rs/zerolog)
to Axiom.

## Quickstart

Follow the [Axiom Go Quickstart](https://github.com/axiomhq/axiom-go#quickstart)
to install the Axiom Go package and configure your environment.

Import the package:

```go
// Imported as "adapter" to not conflict with the "rs/zerolog" package.
import adapter "github.com/axiomhq/axiom-go/adapters/zerolog"
```

You can also configure the adapter using [options](https://pkg.go.dev/github.com/axiomhq/axiom-go/adapters/zerolog#Option)
passed to the [New](https://pkg.go.dev/github.com/axiomhq/axiom-go/adapters/zerolog#New)
function:

```go
writer, err := adapter.New(
    WithDatasetName("logs"),
)
l.Logger = zerolog.New(io.MultiWriter(writer, os.Stderr)).With().Str("env", os.Getenv("ENV")).Timestamp().Logger()
```

To configure the underlying client manually either pass in a client that was
created according to the [Axiom Go Quickstart](https://github.com/axiomhq/axiom-go#quickstart)
using [SetClient](https://pkg.go.dev/github.com/axiomhq/axiom-go/adapters/zerolog#SetClient)
or pass [client options](https://pkg.go.dev/github.com/axiomhq/axiom-go/axiom#Option)
to the adapter using [SetClientOptions](https://pkg.go.dev/github.com/axiomhq/axiom-go/adapters/zerolog#SetClientOptions).

```go
import (
    "github.com/axiomhq/axiom-go/axiom"
    adapter "github.com/axiomhq/axiom-go/adapters/zerolog"
)

// ...
writer, err := adapter.New()
if err != nil {
    log.Fatal(err)
}
l.Logger = zerolog.New(io.MultiWriter(writer, os.Stderr)).With().Str("env", os.Getenv("ENV")).Timestamp().Logger()
```

> [!IMPORTANT]
> The adapter uses a buffer to batch events before sending them to Axiom. This
> buffer can be flushed explicitly by calling [Close](https://pkg.go.dev/github.com/axiomhq/axiom-go/adapters/zerolog#Writer.Close), and is necessary when terminating the program so as not to lose logs.
> If With().Timestamp() isn't passed, then the timestamp will be the batched timestamp on the server 
> Checkout out the [example](../../examples/zerolog/main.go).
